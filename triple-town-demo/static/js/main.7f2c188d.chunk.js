(this["webpackJsonptriple-town-demo"]=this["webpackJsonptriple-town-demo"]||[]).push([[0],{20:function(e,t,n){e.exports=n(33)},25:function(e,t,n){},26:function(e,t,n){},30:function(e,t,n){},33:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(7),o=n.n(i),u=(n(25),n(1)),s=n(2),c=n(3),l=n(4),m=(n(26),n(18)),h=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return n}(Object(m.a)(Error));function d(){for(var e=[],t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];for(var r=0,i=n;r<i.length;r++){var o=i[r];if(o)if(Array.isArray(o))e=e.concat(o);else if("object"===typeof o)for(var u in o)o[u]&&e.push(u);else e.push(o)}return e.join(" ")}var f=n(5);function v(e){return e.split(" ").map((function(e){return parseInt(e)}))}var p=n(13),b={reaction:{minCount:3},scoring:{build:[null,4,20,100,500,1500,5e3,2e4,1e5,5e5],bomb:{ratio:.5}}},y=function e(t,n,a){Object(u.a)(this,e),this.x=t,this.y=n,this.value=a},g=function(){function e(t){Object(u.a)(this,e),this.cells=t.map((function(e,t){return e.map((function(e,n){return new y(t,n,e)}))}))}return Object(s.a)(e,[{key:"inBound",value:function(e,t){return e>=0&&t>=0&&e<this.cells.length&&t<this.cells[e].length}},{key:"toJSON",value:function(){return this.cells.map((function(e){return e.map((function(e){return e.value}))}))}}]),e}(),w=function(){function e(t){var n=t.score,a=t.numBuilt,r=t.numStars,i=t.numBombs,o=t.grid,s=t.command;Object(u.a)(this,e),this.score=n,this.numBuilt=a,this.numStars=r,this.numBombs=i,this.grid=new g(o),this.command=s}return Object(s.a)(e,[{key:"checkReaction",value:function(e,t,n){var a=this;if(9===n)return null;for(var r=[[1,0],[-1,0],[0,1],[0,-1]],i=[[e,t]],o=0;o<i.length;++o){var u,s=Object(f.a)(i[o],2),c=s[0],l=s[1],m=Object(p.a)(r);try{var h=function(){var e=Object(f.a)(u.value,2),t=e[0],r=e[1],o=c+t,s=l+r;!i.some((function(e){var t=Object(f.a)(e,2),n=t[0],a=t[1];return n===o&&a===s}))&&a.grid.inBound(o,s)&&a.grid.cells[o][s].value===n&&i.push([o,s])};for(m.s();!(u=m.n()).done;)h()}catch(d){m.e(d)}finally{m.f()}}return i.length>=b.reaction.minCount?{type:{before:n,after:n+1},cells:i}:null}},{key:"putStructure",value:function(e,t){e.value=t,this.score+=b.scoring.build[t];for(var n=[];;){var a=this.checkReaction(e.x,e.y,e.value);if(!a)break;n.push(a);var r,i=Object(p.a)(a.cells);try{for(i.s();!(r=i.n()).done;){var o=Object(f.a)(r.value,2),u=o[0],s=o[1];this.grid.cells[u][s].value=null}}catch(c){i.e(c)}finally{i.f()}e.value=a.type.after,this.score+=b.scoring.build[a.type.after]}return{phase:n}}},{key:"build",value:function(e,t,n){var a=this.grid.cells[e][t];if(a.value)throw new h("You can't put structures here, since it's not empty.");return this.command="BUILD ".concat(e+1," ").concat(t+1),++this.numBuilt,this.putStructure(a,n)}},{key:"getStarType",value:function(e,t){for(var n=9;n>1;--n)if(this.checkReaction(e,t,n))return n;return 1}},{key:"putStar",value:function(e,t){if(!this.numStars)throw new h("You don't have any stars left.");var n=this.grid.cells[e][t];if(n.value)throw new h("You can't put stars here, since it's not empty.");this.command="STAR ".concat(e+1," ").concat(t+1),--this.numStars;var a=this.getStarType(e,t);return this.putStructure(n,a)}},{key:"putBomb",value:function(e,t){if(!this.numBombs)throw new h("You don't have any bombers left.");var n=this.grid.cells[e][t];if(!n.value)throw new h("You can't put bombers here, since it's empty.");this.command="BOMBER ".concat(e+1," ").concat(t+1),--this.numBombs;var a=b.scoring,r=a.bomb.ratio,i=a.build,o=n.value;return this.score-=r*i[o],n.value=null,{type:o}}},{key:"toJSON",value:function(){return{score:this.score,numBuilt:this.numBuilt,numStars:this.numStars,numBombs:this.numBombs,grid:this.grid.toJSON(),command:this.command}}},{key:"clone",value:function(){return new e(this.toJSON())}}]),e}(),k=n(6),O=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){var e=this.props.classTag.map((function(e){return"board-cell-"+e}));return r.a.createElement("div",{className:d("board-cell",e),onMouseOver:this.props.onHover,onMouseUp:this.props.onClick,onContextMenu:function(e){return e.preventDefault()}},this.props.value)}}]),n}(r.a.Component),j=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"renderCell",value:function(e){var t=this,n=e.x,a=e.y,i=e.value,o=[i||"empty"];return r.a.createElement(O,{key:"".concat(n,",").concat(a),value:i,classTag:o,onHover:function(){return t.props.onHover(n,a)},onClick:function(e){return t.props.onClick(n,a,e)}})}},{key:"renderRow",value:function(e,t){var n=this,a=e.map((function(e){return n.renderCell(e)}));return r.a.createElement("div",{className:"board-row",key:t},a)}},{key:"render",value:function(){var e=this,t=this.props.grid.cells.map((function(t,n){return e.renderRow(t,n)}));return r.a.createElement("div",null,t)}}]),n}(r.a.Component),E=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.selected,a=t.title,i=t.amount,o={active:0===n,"active-second":1===n,disabled:0===i};return r.a.createElement("div",{className:d("game-tool-btn",o),onMouseUp:function(t){return e.props.onClick(t)},onContextMenu:function(e){return e.preventDefault()}},r.a.createElement("strong",{className:"title"},a),r.a.createElement("span",{className:"amount"},i))}}]),n}(r.a.Component),S=function(e){Object(c.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).state={loaded:!1,toasts:[],width:0,height:0,buildQueue:[],history:[],stepNumber:0,selectedTools:["build","star"],preview:null},a.fileInput=r.a.createRef(),a}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.handleKeyDown=this.handleKeyDown.bind(this),document.addEventListener("keydown",this.handleKeyDown)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"handleFileSelect",value:function(){var e=this,t=this.fileInput.current.files;if(0!==t.length){var n=new FileReader;n.readAsText(t[0]),n.onload=function(){var a;try{a=function(e){var t=e.split(/\r?\n/).map((function(e){return e.trim()})).filter((function(e){return e.length>0})),n=v(t[0]),a=Object(f.a)(n,2),r=a[0],i=a[1],o=v(t[1]),u=Object(f.a)(o,2);return{width:i,height:r,numStars:u[0],numBombs:u[1],grid:t.slice(2,2+r).map((function(e){return e.split("").map((function(e){return"."===e?null:parseInt(e)}))})),queue:"0"===t[2+r]?[]:v(t[3+r])}}(n.result)}catch(r){return Object(k.a)("Failed to parse input file."),void console.error(r)}console.log(a),e.loadedFilename=t[0].name,e.loadGame(a)},n.onerror=function(){Object(k.a)("Failed to read input file.")}}else Object(k.a)("No input file was selected.")}},{key:"loadGame",value:function(e){var t=e.width,n=e.height,a=e.numStars,r=e.numBombs,i=e.grid,o=e.queue,u=new w({score:0,numBuilt:0,numStars:a,numBombs:r,grid:i,command:null});this.setState({loaded:!0,width:t,height:n,buildQueue:o,history:[u],stepNumber:0})}},{key:"handleToolSelect",value:function(e,t){var n=0===t.button?0:1,a=this.state.selectedTools.slice(0);a[1-n]===e?a.reverse():a[n]=e,this.setState({selectedTools:a})}},{key:"exportCommands",value:function(){return this.state.history.slice(1,this.state.stepNumber+1).map((function(e){return e.command}))}},{key:"handleKeyDown",value:function(e){if(this.state.loaded&&!this.state.preview){if(e.ctrlKey&&90===e.which){var t=this.state.stepNumber;t>0&&this.setState({stepNumber:t-1})}if(e.ctrlKey&&89===e.which){var n=this.state.stepNumber;n<this.state.history.length-1&&this.setState({stepNumber:n+1})}e.ctrlKey&&67===e.which&&(e.preventDefault(),function(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),t.remove()}(this.exportCommands().join("\n")),Object(k.a)("Operations have been copied to clipboard.")),e.ctrlKey&&83===e.which&&(e.preventDefault(),function(e,t){var n=new Blob([t]),a=URL.createObjectURL(n,{type:"text/plain"}),r=document.createElement("a");r.href=a,r.download=e,document.body.append(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)}(this.loadedFilename.replace(".in",".out"),this.exportCommands().concat("END").join("\n")),Object(k.a)("Output file has been saved."))}}},{key:"handleHover",value:function(e,t){this.state.loaded&&this.state.preview}},{key:"handleClick",value:function(e,t,n){if(this.state.loaded&&!this.state.preview){var a=this.state.history,r=this.state.stepNumber,i=this.currentStep.clone();try{var o=this.state.selectedTools[0===n.button?0:1];switch(o){case"build":var u=this.state.buildQueue;if(i.numBuilt===u.length)throw new h("You have no structure left to be built.");var s=i.build(e,t,u[i.numBuilt]);console.log(s);break;case"star":i.putStar(e,t);break;case"bomb":i.putBomb(e,t);break;default:throw new Error("Unknown tool: "+o)}}catch(c){return void(c instanceof h?Object(k.a)(c.message):(Object(k.a)("An unexpected error occured."),console.error(c)))}a=a.slice(0,++r).concat(i),this.setState({history:a,stepNumber:r})}}},{key:"jumpTo",value:function(e){this.setState({stepNumber:e})}},{key:"renderGameUI",value:function(){var e=this,t=this.state.history,n=this.state.preview||this.currentStep,a=this.state.buildQueue,i=[{name:"build",title:"Build",amount:this.state.buildQueue.length-n.numBuilt},{name:"star",title:"Star",amount:n.numStars},{name:"bomb",title:"Bomber",amount:n.numBombs}].map((function(t){var n=t.name,a=t.title,i=t.amount;return r.a.createElement(E,{key:n,title:a,amount:i,selected:e.state.selectedTools.indexOf(n),onClick:function(t){return e.handleToolSelect(n,t)}})})),o=t.map((function(t,n){return r.a.createElement("li",{key:n,className:n===e.state.stepNumber?"active":"",onMouseOver:function(){return e.setState({preview:t})},onMouseOut:function(){return e.setState({preview:null})},onClick:function(){return e.jumpTo(n)}},t.command||"(start)")})),u=this.state.buildQueue.slice(n.numBuilt);if(u.length>40){var s=u.length-40;u=u.slice(0,40).concat("... (".concat(s," more)"))}return u=u.length?[r.a.createElement("strong",{key:"first"},u[0]," "),r.a.createElement("span",{key:"other"},u.slice(1).join(" "))]:r.a.createElement("span",null,"(queue empty)"),r.a.createElement("div",{className:"game"},r.a.createElement("div",null,r.a.createElement("div",{className:"game-toolbar"},i)),r.a.createElement("div",null,r.a.createElement("div",{className:"game-queue"},u)),r.a.createElement("div",null,r.a.createElement("div",{className:"game-board"},r.a.createElement(j,{grid:n.grid,onHover:function(t,n){return e.handleHover(t,n)},onClick:function(t,n,a){return e.handleClick(t,n,a)}})),r.a.createElement("div",{className:"game-info"},r.a.createElement("ul",null,r.a.createElement("li",null,"Board: ",this.state.width," x ",this.state.height),r.a.createElement("li",null,"Round: ",this.state.stepNumber),r.a.createElement("li",null,"Score: ",n.score),r.a.createElement("li",null,"Queue: ",n.numBuilt," / ",a.length),r.a.createElement("li",null,"Stars: ",n.numStars),r.a.createElement("li",null,"Bombers: ",n.numBombs))),r.a.createElement("div",{className:"game-history"},r.a.createElement("ol",{start:"0"},o))))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",{className:"game-file-select"},r.a.createElement("input",{type:"file",ref:this.fileInput}),r.a.createElement("input",{type:"button",value:"Start",onClick:function(){return e.handleFileSelect()}})),this.state.loaded&&this.renderGameUI())}},{key:"currentStep",get:function(){return this.state.history[this.state.stepNumber]}}]),n}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(S,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},6:function(e,t,n){"use strict";(function(e){var a=n(11),r=n(1),i=n(2),o=n(3),u=n(4),s=n(0),c=n.n(s),l=n(7),m=n.n(l),h=n(17),d=(n(30),4e3),f=800,v=function(t){Object(o.a)(a,t);var n=Object(u.a)(a);function a(t){var i;return Object(r.a)(this,a),(i=n.call(this,t)).state={show:!1},e((function(){i.setState({show:!0})})),i}return Object(i.a)(a,[{key:"render",value:function(){return c.a.createElement(h.a,{in:this.state.show&&this.props.show,classNames:"toast",timeout:f,onExited:this.props.onFadeOut,unmountOnExit:!0},c.a.createElement("div",{className:"toast-item"},this.props.message))}}]),a}(c.a.Component),p=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(r.a)(this,n),(i=t.call(this,e)).state={toasts:[]},i.timeouts=new Set,e.triggerRef(Object(a.a)(i)),i}return Object(i.a)(n,[{key:"componentWillUnmount",value:function(){this.timeouts.forEach((function(e){return clearTimeout(e)}))}},{key:"createTimeout",value:function(e,t){var n=this,a=setTimeout((function(){n.timeouts.delete(a),e()}),t);return this.timeouts.add(a),a}},{key:"generateToastId",value:function(){var e="0123456789abcdefghijklmnopqrstuvwxyz";return[Date.now(),new Array(8).fill(0).map((function(){return e[Math.floor(Math.random()*e.length)]})).join("")].join("-")}},{key:"push",value:function(e){var t=this,n={id:this.generateToastId(),message:e,show:!0};this.setState((function(e){return{toasts:e.toasts.concat(n)}})),this.createTimeout((function(){n.show=!1,t.setState({toasts:t.state.toasts})}),d)}},{key:"remove",value:function(e){this.setState((function(t){return{toasts:t.toasts.filter((function(t){return t.id!==e}))}}))}},{key:"render",value:function(){var e=this,t=this.state.toasts.map((function(t){return c.a.createElement(v,{key:t.id,message:t.message,show:t.show,onFadeOut:function(){return e.remove(t.id)}})}));return c.a.createElement("div",{className:"toast-container"},t)}}]),n}(c.a.Component);t.a=function(){var e,t=document.createElement("div");return document.body.appendChild(t),m.a.render(c.a.createElement(p,{triggerRef:function(t){return e=t}}),t),function(t){e.push(t)}}()}).call(this,n(27).setImmediate)}},[[20,1,2]]]);
//# sourceMappingURL=main.7f2c188d.chunk.js.map