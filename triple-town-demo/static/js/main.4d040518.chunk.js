(this["webpackJsonptriple-town-demo"]=this["webpackJsonptriple-town-demo"]||[]).push([[0],{1:function(e,t,n){"use strict";(function(e){var a=n(4),r=n(3),o=n(5),i=n(6),u=n(7),c=n(0),s=n.n(c),l=n(9),m=n.n(l),h=n(19),d=(n(33),4e3),v=800,f=function(t){Object(i.a)(a,t);var n=Object(u.a)(a);function a(t){var o;return Object(r.a)(this,a),(o=n.call(this,t)).state={show:!1},e((function(){o.setState({show:!0})})),o}return Object(o.a)(a,[{key:"render",value:function(){return s.a.createElement(h.a,{in:this.state.show&&this.props.show,classNames:"toast",timeout:v,onExited:this.props.onFadeOut,unmountOnExit:!0},s.a.createElement("div",{className:"toast-item"},this.props.message))}}]),a}(s.a.Component),p=function(e){Object(i.a)(n,e);var t=Object(u.a)(n);function n(e){var o;return Object(r.a)(this,n),(o=t.call(this,e)).state={toasts:[]},o.timeouts=new Set,e.triggerRef(Object(a.a)(o)),o}return Object(o.a)(n,[{key:"componentWillUnmount",value:function(){this.timeouts.forEach((function(e){return clearTimeout(e)}))}},{key:"createTimeout",value:function(e,t){var n=this,a=setTimeout((function(){n.timeouts.delete(a),e()}),t);return this.timeouts.add(a),a}},{key:"generateToastId",value:function(){var e="0123456789abcdefghijklmnopqrstuvwxyz";return[Date.now(),new Array(8).fill(0).map((function(){return e[Math.floor(Math.random()*e.length)]})).join("")].join("-")}},{key:"push",value:function(e){var t=this,n={id:this.generateToastId(),message:e,show:!0};this.setState((function(e){return{toasts:e.toasts.concat(n)}})),this.createTimeout((function(){n.show=!1,t.setState({toasts:t.state.toasts})}),d)}},{key:"remove",value:function(e){this.setState((function(t){return{toasts:t.toasts.filter((function(t){return t.id!==e}))}}))}},{key:"render",value:function(){var e=this,t=this.state.toasts.map((function(t){return s.a.createElement(f,{key:t.id,message:t.message,show:t.show,onFadeOut:function(){return e.remove(t.id)}})}));return s.a.createElement("div",{className:"toast-container"},t)}}]),n}(s.a.Component);t.a=function(){var e,t=document.createElement("div");return document.body.appendChild(t),m.a.render(s.a.createElement(p,{triggerRef:function(t){return e=t}}),t),function(t){e.push(t)}}()}).call(this,n(30).setImmediate)},23:function(e,t,n){e.exports=n(36)},28:function(e,t,n){},29:function(e,t,n){},33:function(e,t,n){},36:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(9),i=n.n(o),u=(n(28),n(21)),c=n(8),s=n(2),l=n(4),m=n(3),h=n(5),d=n(6),v=n(7),f=(n(29),n(20)),p=function(e){Object(d.a)(n,e);var t=Object(v.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return n}(Object(f.a)(Error));function b(){for(var e=[],t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];for(var r=0,o=n;r<o.length;r++){var i=o[r];if(i)if(Array.isArray(i))e=e.concat(i);else if("object"===typeof i)for(var u in i)i[u]&&e.push(u);else e.push(i)}return e.join(" ")}function y(e){return e.split(" ").map((function(e){return parseInt(e)}))}var w={reaction:{minCount:3},scoring:{build:[null,4,20,100,500,1500,5e3,2e4,1e5,5e5],bomb:{ratio:.5}}},g=function e(t,n,a){Object(m.a)(this,e),this.x=t,this.y=n,this.value=a},O=function(){function e(t){Object(m.a)(this,e),this.cells=t.map((function(e,t){return e.map((function(e,n){return new g(t,n,e)}))}))}return Object(h.a)(e,[{key:"inBound",value:function(e,t){return e>=0&&t>=0&&e<this.cells.length&&t<this.cells[e].length}},{key:"toJSON",value:function(){return this.cells.map((function(e){return e.map((function(e){return e.value}))}))}}]),e}(),k=function(){function e(t){var n=t.score,a=t.numBuilt,r=t.numStars,o=t.numBombs,i=t.grid,u=t.command;Object(m.a)(this,e),this.score=n,this.numBuilt=a,this.numStars=r,this.numBombs=o,this.grid=new O(i),this.command=u}return Object(h.a)(e,[{key:"checkReaction",value:function(e,t,n){var a=this;if(9===n)return null;for(var r=[[1,0],[-1,0],[0,1],[0,-1]],o=[[e,t]],i=0;i<o.length;++i){var u,l=Object(s.a)(o[i],2),m=l[0],h=l[1],d=Object(c.a)(r);try{var v=function(){var e=Object(s.a)(u.value,2),t=e[0],r=e[1],i=m+t,c=h+r;!o.some((function(e){var t=Object(s.a)(e,2),n=t[0],a=t[1];return n===i&&a===c}))&&a.grid.inBound(i,c)&&a.grid.cells[i][c].value===n&&o.push([i,c])};for(d.s();!(u=d.n()).done;)v()}catch(f){d.e(f)}finally{d.f()}}return o.length>=w.reaction.minCount?{type:{before:n,after:n+1},cells:o}:null}},{key:"putStructure",value:function(e,t){e.value=t,this.score+=w.scoring.build[t];for(var n=[];;){var a=this.checkReaction(e.x,e.y,e.value);if(!a)break;n.push(a);var r,o=Object(c.a)(a.cells);try{for(o.s();!(r=o.n()).done;){var i=Object(s.a)(r.value,2),u=i[0],l=i[1];this.grid.cells[u][l].value=null}}catch(m){o.e(m)}finally{o.f()}e.value=a.type.after,this.score+=w.scoring.build[a.type.after]}return{phase:n}}},{key:"build",value:function(e,t,n){var a=this.grid.cells[e][t];if(a.value)throw new p("You can't put structures here, since it's not empty.");return this.command="PUT ".concat(e+1," ").concat(t+1),++this.numBuilt,this.putStructure(a,n)}},{key:"getStarType",value:function(e,t){for(var n=9;n>1;--n)if(this.checkReaction(e,t,n))return n;return 1}},{key:"putStar",value:function(e,t){if(!this.numStars)throw new p("You don't have any stars left.");var n=this.grid.cells[e][t];if(n.value)throw new p("You can't put stars here, since it's not empty.");this.command="STAR ".concat(e+1," ").concat(t+1),--this.numStars;var a=this.getStarType(e,t);return this.putStructure(n,a)}},{key:"putBomb",value:function(e,t){if(!this.numBombs)throw new p("You don't have any bombers left.");var n=this.grid.cells[e][t];if(!n.value)throw new p("You can't put bombers here, since it's empty.");this.command="BOMBER ".concat(e+1," ").concat(t+1),--this.numBombs;var a=w.scoring,r=a.bomb.ratio,o=a.build,i=n.value;return this.score-=r*o[i],n.value=null,{type:i}}},{key:"toJSON",value:function(){return{score:this.score,numBuilt:this.numBuilt,numStars:this.numStars,numBombs:this.numBombs,grid:this.grid.toJSON(),command:this.command}}},{key:"clone",value:function(){return new e(this.toJSON())}}]),e}(),j=n(1),E=function(e){Object(d.a)(n,e);var t=Object(v.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"render",value:function(){var e=this,t=this.props.cell,n=t.x,a=t.y,o=t.value,i=t.isPreview,u=t.reaction,c=[];return c.push(o||"empty"),i&&c.push("preview"),u&&c.push("reaction"),r.a.createElement("div",{className:b("board-cell",c.map((function(e){return"board-cell-"+e}))),onMouseOver:function(){return e.props.onHover({x:n,y:a})},onMouseOut:function(){return e.props.onHover(null)},onMouseUp:function(n){return e.props.onClick(t,n)},onContextMenu:function(e){return e.preventDefault()}},r.a.createElement("span",null,o))}}]),n}(r.a.Component),S=function(e){Object(d.a)(n,e);var t=Object(v.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"renderCell",value:function(e){var t=e.x,n=e.y;return r.a.createElement(E,{key:"".concat(t,",").concat(n),cell:e,onHover:this.props.onHover,onClick:this.props.onClick})}},{key:"renderRow",value:function(e,t){var n=this,a=e.map((function(e){return n.renderCell(e)}));return r.a.createElement("div",{className:"board-row",key:t},a)}},{key:"render",value:function(){var e=this,t=this.props.grid.cells.map((function(t,n){return e.renderRow(t,n)}));return r.a.createElement("div",null,t)}}]),n}(r.a.Component),C=function(e){Object(d.a)(n,e);var t=Object(v.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.selected,a=t.title,o=t.amount,i={active:0===n,"active-second":1===n,disabled:0===o};return r.a.createElement("div",{className:b("game-tool-btn",i),onMouseUp:function(t){return e.props.onClick(t)},onContextMenu:function(e){return e.preventDefault()}},r.a.createElement("strong",{className:"title"},a),r.a.createElement("span",{className:"amount"},o))}}]),n}(r.a.Component),N=function(e){Object(d.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(m.a)(this,n),(a=t.call(this,e)).state={loaded:!1,toasts:[],width:0,height:0,buildQueue:[],history:[],stepNumber:0,selectedTools:["build","star"],hover:null,hoverType:""},a.fileInput=r.a.createRef(),a.commandInput=r.a.createRef(),a.handleHover=a.handleHover.bind(Object(l.a)(a)),a.handleClick=a.handleClick.bind(Object(l.a)(a)),a.handleKeyDown=a.handleKeyDown.bind(Object(l.a)(a)),a.handleHistoryHover=a.handleHistoryHover.bind(Object(l.a)(a)),a.handleCommandExec=a.handleCommandExec.bind(Object(l.a)(a)),a.handleCommandClear=a.handleCommandClear.bind(Object(l.a)(a)),a}return Object(h.a)(n,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown,!1)}},{key:"handleFileSelect",value:function(){var e=this,t=this.fileInput.current.files;if(0!==t.length){var n=new FileReader;n.readAsText(t[0]),n.onload=function(){var a;try{a=function(e){var t=e.split(/\r?\n/).map((function(e){return e.trim()})).filter((function(e){return e.length>0})),n=y(t[0]),a=Object(s.a)(n,2),r=a[0],o=a[1],i=y(t[1]),u=Object(s.a)(i,2);return{width:o,height:r,numStars:u[0],numBombs:u[1],grid:t.slice(2,2+r).map((function(e){return e.split("").map((function(e){return"."===e?null:parseInt(e)}))})),queue:"0"===t[2+r]?[]:y(t[3+r])}}(n.result)}catch(r){return Object(j.a)("Failed to parse input file."),void console.error(r)}console.log(a),e.loadedFilename=t[0].name,e.loadGame(a)},n.onerror=function(){Object(j.a)("Failed to read input file.")}}else Object(j.a)("No input file was selected.")}},{key:"loadGame",value:function(e){var t=e.width,n=e.height,a=e.numStars,r=e.numBombs,o=e.grid,i=e.queue,u=new k({score:0,numBuilt:0,numStars:a,numBombs:r,grid:o,command:null});this.setState({loaded:!0,width:t,height:n,buildQueue:i,history:[u],stepNumber:0})}},{key:"handleToolSelect",value:function(e,t){var n=0===t.button?0:1,a=this.state.selectedTools.slice(0);a[1-n]===e?a.reverse():a[n]=e,this.setState({selectedTools:a})}},{key:"exportCommands",value:function(){return this.state.history.slice(1,this.state.stepNumber+1).map((function(e){return e.command}))}},{key:"handleKeyDown",value:function(e){if(this.state.loaded){if(e.ctrlKey&&90===e.which){var t=this.state.stepNumber;t>0?this.setState({stepNumber:t-1}):Object(j.a)("No operation can be undone.")}if(e.ctrlKey&&89===e.which){var n=this.state.stepNumber;n<this.state.history.length-1?this.setState({stepNumber:n+1}):Object(j.a)("No operation can be redone.")}e.ctrlKey&&67===e.which&&(e.preventDefault(),this.state.stepNumber>0?(!function(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),t.remove()}(this.exportCommands().concat("").join("\n")),Object(j.a)("Commands have been copied to clipboard.")):Object(j.a)("No command can be copied.")),e.ctrlKey&&83===e.which&&(e.preventDefault(),function(e,t){var n=new Blob([t]),a=URL.createObjectURL(n,{type:"text/plain"}),r=document.createElement("a");r.href=a,r.download=e,document.body.append(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)}(this.loadedFilename.replace(".in",".out"),this.exportCommands().concat("END","").join("\n")),Object(j.a)("Output file has been saved."))}}},{key:"handleHover",value:function(e){this.setState({hover:e,hoverType:"cell"})}},{key:"buildWithin",value:function(e,t,n){var a=this.state.buildQueue;if(e.numBuilt===a.length)throw new p("You have no structure left to build.");return e.build(t,n,a[e.numBuilt])}},{key:"handleClick",value:function(e,t){var n=e.x,a=e.y,r=this.state.history,o=this.state.stepNumber,i=this.currentStep.clone();try{var u=this.state.selectedTools[0===t.button?0:1];switch(u){case"build":this.buildWithin(i,n,a);break;case"star":i.putStar(n,a);break;case"bomb":i.putBomb(n,a);break;default:throw new Error("Unknown tool: "+u)}}catch(c){return void(c instanceof p?Object(j.a)(c.message):(Object(j.a)("An unexpected error occured."),console.error(c)))}r=r.slice(0,++o).concat(i),this.setState({history:r,stepNumber:o})}},{key:"handleHistoryHover",value:function(e){this.setState({hover:e,hoverType:"history"})}},{key:"handleCommandExec",value:function(){var e=this.commandInput.current.value.split("\n"),t=this.state,n=t.stepNumber,a=t.history,r=[],o=this.currentStep;function i(e){if(2!==e.length)throw new p("There should be exactly 2 params for this command.");var t=e.map((function(e){if(e=Number(e),!Number.isInteger(e))throw new p("All params should be integers.");return e-1})),n=Object(s.a)(t,2),a=n[0],r=n[1];if(!o.grid.inBound(a,r))throw new p("Coordinates out of range.");return[a,r]}var l,m=0,h=0,d=Object(c.a)(e);try{for(d.s();!(l=d.n()).done;){var v=l.value;if(m++,v=v.trim()){h++;var f=v.split(/\s+/),b=Object(u.a)(f),y=b[0],w=b.slice(1);try{switch(o=o.clone(),y.toLowerCase()){case"put":var g=i(w),O=Object(s.a)(g,2),k=O[0],E=O[1];this.buildWithin(o,k,E);break;case"star":var S=i(w),C=Object(s.a)(S,2),N=C[0],B=C[1];o.putStar(N,B);break;case"bomber":var x=i(w),T=Object(s.a)(x,2),H=T[0],I=T[1];o.putBomb(H,I);break;default:throw new p("Unknown command '".concat(y,"'."))}r.push(o)}catch(R){return R instanceof p?void Object(j.a)("Error on line ".concat(m,": ").concat(R.message,"\nExecution was interrupted.")):void Object(j.a)("An unknown error occured when executing line ".concat(m,".\nChanges will be rolled back."))}}}}catch(R){d.e(R)}finally{d.f()}h?(Object(j.a)("Success: ".concat(h," command").concat(h>1?"s were":" was"," executed.")),this.setState({stepNumber:n+r.length,history:a.slice(0,n+1).concat(r)})):Object(j.a)("No command was found.")}},{key:"handleCommandClear",value:function(){this.commandInput.current.value="",Object(j.a)("Commands have been cleared.")}},{key:"getToolPreview",value:function(e,t,n){var a=n.x,r=n.y,o=e.grid.cells[a][r];switch(t){case"build":var i=this.state.buildQueue;if(e.numBuilt<i.length&&!o.value){var u,l=e.clone(),m=l.grid.cells[a][r],h=i[e.numBuilt],d=e.clone(),v=d.build(a,r,h),f=Object(c.a)(v.phase);try{for(f.s();!(u=f.n()).done;){var p,b=u.value.cells,y=Object(c.a)(b);try{for(y.s();!(p=y.n()).done;){var w=Object(s.a)(p.value,2),g=w[0],O=w[1];l.grid.cells[g][O].reaction=!0}}catch(D){y.e(D)}finally{y.f()}}}catch(D){f.e(D)}finally{f.f()}return m.value=d.grid.cells[a][r].value,m.isPreview=!0,l}break;case"star":if(e.numStars&&!o.value){var k,j=e.clone(),E=j.grid.cells[a][r],S=e.clone(),C=S.putStar(a,r),N=Object(c.a)(C.phase);try{for(N.s();!(k=N.n()).done;){var B,x=k.value.cells,T=Object(c.a)(x);try{for(T.s();!(B=T.n()).done;){var H=Object(s.a)(B.value,2),I=H[0],R=H[1];j.grid.cells[I][R].reaction=!0}}catch(D){T.e(D)}finally{T.f()}}}catch(D){N.e(D)}finally{N.f()}return E.value=S.grid.cells[a][r].value,E.isPreview=!0,j}}return e}},{key:"getDisplayState",value:function(){var e=this.state,t=e.hover,n=e.hoverType,a=this.currentStep;if(!t)return a;switch(n){case"cell":return this.getToolPreview(a,this.state.selectedTools[0],t);case"history":return t;default:throw new Error("Unknown hover type.")}}},{key:"renderGameUI",value:function(){var e=this,t=this.state.history,n=this.state.buildQueue,a=this.getDisplayState(),o=[{name:"build",title:"Build",amount:this.state.buildQueue.length-a.numBuilt},{name:"star",title:"Star",amount:a.numStars},{name:"bomb",title:"Bomber",amount:a.numBombs}].map((function(t){var n=t.name,a=t.title,o=t.amount;return r.a.createElement(C,{key:n,title:a,amount:o,selected:e.state.selectedTools.indexOf(n),onClick:function(t){return e.handleToolSelect(n,t)}})})),i=t.map((function(t,n){return r.a.createElement("li",{key:n,className:n===e.state.stepNumber?"active":"",onMouseOver:function(){return e.handleHistoryHover(t)},onMouseOut:function(){return e.handleHistoryHover(null)},onClick:function(){return e.setState({stepNumber:n})}},t.command||"Start")})),u=this.state.buildQueue.slice(a.numBuilt);if(u.length>40){var c=u.length-40;u=u.slice(0,40).concat("... (".concat(c," more)"))}return u=u.length?[r.a.createElement("strong",{key:"first"},u[0]," "),r.a.createElement("span",{key:"other"},u.slice(1).join(" "))]:r.a.createElement("span",null,"(queue empty)"),r.a.createElement("div",{className:"game"},r.a.createElement("div",null,r.a.createElement("div",{className:"game-toolbar"},o)),r.a.createElement("div",null,r.a.createElement("div",{className:"game-queue"},u)),r.a.createElement("div",null,r.a.createElement("div",{className:"game-board"},r.a.createElement(S,{grid:a.grid,onHover:this.handleHover,onClick:this.handleClick})),r.a.createElement("div",{className:"game-info"},r.a.createElement("ul",null,r.a.createElement("li",null,"Board: ",this.state.width," x ",this.state.height),r.a.createElement("li",null,"Round: ",this.state.stepNumber),r.a.createElement("li",null,"Score: ",a.score),r.a.createElement("li",null,"Queue: ",a.numBuilt," / ",n.length),r.a.createElement("li",null,"Stars: ",a.numStars),r.a.createElement("li",null,"Bombers: ",a.numBombs))),r.a.createElement("div",{className:"game-history"},r.a.createElement("ol",{start:"0"},i)),r.a.createElement("div",{className:"game-command-input"},r.a.createElement("div",null,r.a.createElement("textarea",{rows:"15",cols:"15",ref:this.commandInput,onMouseDown:function(e){return e.target.readOnly=!1},onBlur:function(e){return e.target.readOnly=!0},onKeyDown:function(e){return e.nativeEvent.stopImmediatePropagation()}}),r.a.createElement("input",{type:"hidden",id:"fix-focus"})),r.a.createElement("div",{className:"actions"},r.a.createElement("input",{type:"button",value:"Execute",onClick:this.handleCommandExec}),r.a.createElement("input",{type:"button",value:"Clear",onClick:this.handleCommandClear})))))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("div",{className:"game-file-select"},r.a.createElement("input",{type:"file",ref:this.fileInput}),r.a.createElement("input",{type:"button",value:"Start",onClick:function(){return e.handleFileSelect()}})),this.state.loaded&&this.renderGameUI())}},{key:"currentStep",get:function(){return this.state.history[this.state.stepNumber]}}]),n}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(N,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[23,1,2]]]);
//# sourceMappingURL=main.4d040518.chunk.js.map